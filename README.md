# ИДЗ 2. Процессы. Синхронизация. Использование семафоров. 

**Хрушков Степан Игоревич БПИ227** 

**Вариант 6**  

Условие: Базу данных, представленную массивом целых положительных чисел, разделяют два типа процессов: N читателей и K писателей.   
Читатели периодически просматривают случайные записи базы данных и выводя номер свой номер (например, PID), индекс записи, ее значение, а также вычисленное значение факториала.  
Писатели изменяют случайные записи на случайное число и также выводят информацию о своем номере, индексе записи, старом значении и новом значении.   
Предполагается, что в начале БД находится в непротиворечивом состоянии (все числа отсортированы).   
Каждая отдельная новая запись переводит БД из одного непротиворечивого состояния в другое (то есть, новая сортировка может поменять индексы записей или переставить числа).  
Транзакции выполняются в режиме «грязного чтения». То есть, процесс–писатель не может получить доступ к БД только в том случае, если ее уже занял другой процесс-писатель, а процессы-читатели ему не мешают обратиться к БД.  
Поэтому он может изменять базу данных, когда в ней находятся читатели.  
Создать многопроцессное приложение с потоками-писателями и потоками-читателями.  
Каждый читатель и писатель моделируется отдельным процессом.  

Сценарий использования:
Предположим, что в университете или компании необходимо постоянно обновлять и анализировать большие объемы данных. Писатели могут быть процессами, обновляющими записи о последних событиях или транзакциях, в то время как читатели могут анализировать эти данные для генерации отчетов или вывода статистики.

**4-5 баллов** - semaphore_v1.1  

В  программе представлены два типа процессов: писатели и читатели, которые взаимодействуют с одним и тем же ресурсом — разделяемой памятью. Эти процессы используют **именнованные** POSIX семафоры для синхронизации доступа к разделяемой памяти. Каждый писатель блокирует доступ к разделяемой памяти перед тем, как произвести изменение, и разблокирует его после завершения операции. Это предотвращает нарушение целостности данных во время записи.
Читатели могут одновременно читать данные, не ожидая освобождения семафора, что отражает вашу концепцию "грязного чтения".

Добавлено условие завершения программы по сигналу: при получении сигнала SIGINT (Ctrl+C). 
Предусмотрено удаление семафоров и разделяемой памяти по завершению работы программы. Это делается в обработчике сигнала handle_sigint, который вызывается при получении сигнала SIGINT (Ctrl+C). 

**munmap** - Отсоединяет разделяемую память от адресного пространства процесса, что предотвращает дальнейший доступ к ней.  
**close** - Закрывает файловый дескриптор, ассоциированный с разделяемой памятью, что уменьшает количество открытых дескрипторов в системе.  
**shm_unlink** - Удаляет объект разделяемой памяти из файловой системы, освобождая ресурсы, которые были заняты под этот объект.  
**sem_close** -  Закрывает именованный семафор, отсоединяя его от процесса.  
**sem_unlink** -  Удаляет именованный семафор из системы, что приводит к освобождению занятых им ресурсов после закрытия всех дескрипторов семафора.  
  
Если программа завершится иным способом, например, через вызов exit(), то эти ресурсы могут не быть корректно очищены, что потенциально приведет к проблемам.

**Пример работы программы:** Каждое изменение значения в базе данных показано пошагово, где видно, что каждый процесс-писатель последовательно получает доступ к базе данных, изменяет значение, а затем освобождает доступ. Это подтверждает, что именованный семафор работает корректно, позволяя только одному писателю в один момент времени изменять данные. 

<img width="1063" alt="Снимок экрана 2024-04-22 в 18 41 23" src="https://github.com/StepaKH/OS/blob/main/%D0%98%D0%94%D0%97_2/static/1.png">

**6-7 баллов** - semaphore_v2.2  

В отличии от программы на 4-5 баллов процессы взаимодействуют с использованием **неименованных** POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX. 
<img width="1049" alt="Снимок экрана 2024-04-22 в 18 44 06" src="https://github.com/StepaKH/OS/blob/main/%D0%98%D0%94%D0%97_2/static/2.png">

**8 баллов** - semaphore_v3.3

В дополнение к программам на предыдущие оценки необходимо разработать приложение, состоящую из отдельных программ–процессов, запускаемых независимо друг от друга. Требования:

1. Для завершения приложения использовать те же подходы, что и в предыдущих решениях.
2. Приложение может использовать обмен данными через разделяемую память. Применение семафоров в программе возможно по следующему варианту: • Множество независимых процессов взаимодействуют с использованием семафоров в стандарте UNIX SYSTEM V. Обмен данными ведется через разделяемую память в стандарте UNIX SYSTEM V.
3. В отчет расширить информацией о добавленной реализации и привести соответствующие результаты работы программы.

### Как реализовано:
Этот код создает семафор и разделяемую память с использованием ключей IPC_PRIVATE. Каждый процесс, писатель и читатель, захватывает семафор перед доступом к разделяемой памяти и освобождает его после завершения операции. Таким образом, механизм семафоров обеспечивает синхронизацию доступа к разделяемой памяти.

1. Использование семафоров в стандарте UNIX System V: В коде используется механизм семафоров из стандарта UNIX System V для синхронизации доступа к разделяемой памяти. Каждый процесс захватывает семафор перед доступом к данным и освобождает его после завершения операции.
2. Обмен данными через разделяемую память в стандарте UNIX System V: Данные обмениваются между процессами через разделяемую память, созданную с помощью функции shmget, а затем отображенную в адресное пространство каждого процесса с помощью shmat.
3. Обработка завершения приложения: Для завершения приложения используется обработчик сигнала SIGINT, который очищает ресурсы, включая семафор и разделяемую память

<img width="1049" alt="Снимок экрана 2024-04-22 в 18 44 06" src="https://github.com/StepaKH/OS/blob/main/%D0%98%D0%94%D0%97_2/static/3.png">



